<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DonationConnect — Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --primary:#2563eb; --muted:#6b7280; --max-w:1200px }
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:#f5f7fa;color:#222}
    .container{max-width:var(--max-w);margin:0 auto;padding:20px}
    header{background:linear-gradient(135deg,#2c3e50,#2563eb);color:#fff;padding:18px;border-radius:8px;margin:20px 0}
    .dashboard-header{display:flex;justify-content:space-between;align-items:center;margin:8px 0 18px}
    .dashboard-content{display:grid;grid-template-columns:1fr 3fr;gap:20px}
    .sidebar{background:#fff;border-radius:8px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
    .sidebar h3{margin-bottom:12px}
    .sidebar ul{list-style:none;padding:0;margin:0}
    .sidebar li{padding:10px 0;border-bottom:1px solid #f5f5f5;cursor:pointer}
    .sidebar li.active{font-weight:700;color:var(--primary)}
    .main-content{background:#fff;border-radius:8px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
    .card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-top:12px}
    .card{border:1px solid #eee;border-radius:8px;overflow:hidden}
    .card-header{background:var(--primary);color:#fff;padding:12px}
    .card-body{padding:12px}
    .card-footer{padding:12px;background:#fafafa;display:flex;justify-content:space-between}
    .btn{padding:8px 14px;border-radius:6px;border:none;cursor:pointer}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-secondary{background:transparent;border:1px solid #ddd}
    .empty{color:var(--muted);padding:16px;border:1px dashed #eee;border-radius:8px;text-align:center}
    @media (max-width:768px){ .dashboard-content{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">DonationConnect — Platform Dashboard</div>
    </header>

    <div class="dashboard-header">
      <h2>Platform Dashboard</h2>
      <div>
        <a class="btn btn-primary" href="create-drive.html">New Drive</a>
        <button id="btnCreateDonation" class="btn btn-secondary" style="margin-left:8px;">Create Tracked Donation</button>
      </div>
    </div>

    <div class="dashboard-content">
      <div class="sidebar" role="navigation" aria-label="Dashboard navigation">
        <h3>Dashboard</h3>
        <ul>
          <li class="active" data-tab="overview">Overview</li>
          <li data-tab="drives">Donation Drives</li>
          <li data-tab="reports">Reports & Analytics</li>
          <li data-tab="modules"><a href="module.html">Modules</a></li>
        </ul>
      </div>

      <div class="main-content">
        <!-- Overview -->
        <section class="content-section active" id="overview" aria-live="polite">
          <h3>Platform Overview</h3>
          <p>Manage drives, donations and view analytics.</p>

          <div class="card-grid" id="overviewCards">
            <div class="card">
              <div class="card-header"><h4 style="margin:0">Active Users</h4></div>
              <div class="card-body"><p id="statUsers">—</p></div>
              <div class="card-footer"><button class="btn btn-primary" onclick="alert('Open Users (not implemented)')">View Details</button></div>
            </div>
            <div class="card">
              <div class="card-header"><h4 style="margin:0">Active Donations</h4></div>
              <div class="card-body"><p id="statDonations">—</p></div>
              <div class="card-footer"><button class="btn btn-primary" id="manageDonations">Manage</button></div>
            </div>
            <div class="card">
              <div class="card-header"><h4 style="margin:0">Pending Deliveries</h4></div>
              <div class="card-body"><p id="statPending">—</p></div>
              <div class="card-footer"><button class="btn btn-primary" id="viewRoutes">View Routes</button></div>
            </div>
          </div>
        </section>

        <!-- Donation Drives -->
        <section class="content-section" id="drives" hidden>
          <h3>Donation Drives</h3>
          <p>Manage created donation drives.</p>
          <div id="drivesList"></div>
        </section>

        <!-- Reports & Analytics -->
        <section class="content-section" id="reports" hidden>
          <h3>Reports & Analytics</h3>
          <p>Basic analytics generated from stored donations and drives.</p>
          <div id="reportsContent"></div>
        </section>

        <!-- Modules -->
        <section class="content-section" id="modules" hidden>
          <h3>Modules</h3>
          <p>Open module pages for specific workflows.</p>
          <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px">
            <a class="btn btn-primary" href="admin-module.html">Admin</a>
            <a class="btn btn-primary" href="donor-module.html">Donor</a>
            <a class="btn btn-primary" href="recipient-module.html">Recipient</a>
            <a class="btn btn-primary" href="logistics-module.html">Logistics</a>
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    const sidebarItems = document.querySelectorAll('.sidebar li[data-tab]');
    const contentSections = document.querySelectorAll('.content-section');
    const KEY_DRIVES = 'donationconnect:drives';
    const KEY_DONATIONS = 'donationconnect:donations';

    function readJSON(key){ try { return JSON.parse(localStorage.getItem(key) || '[]'); } catch(e){ return []; } }
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    function setActiveTab(tabId){
      sidebarItems.forEach(li => li.classList.toggle('active', li.getAttribute('data-tab') === tabId));
      contentSections.forEach(sec => {
        const match = sec.id === tabId;
        sec.hidden = !match;
        sec.classList.toggle('active', match);
      });
      if(tabId === 'drives') renderDrives();
      if(tabId === 'reports') renderReports();
      if(tabId === 'overview') renderOverview();
    }

    sidebarItems.forEach(item => {
      item.addEventListener('click', () => {
        const tabId = item.getAttribute('data-tab');
        setActiveTab(tabId);
        history.replaceState(null, '', '#' + tabId);
      });
    });

    function renderDrives(){
      const container = document.getElementById('drivesList');
      const drives = readJSON(KEY_DRIVES);
      if(!drives.length){
        container.innerHTML = '<div class="empty">No drives. Create one using "New Drive".</div>';
        return;
      }
      container.innerHTML = drives.map(d => `
        <div class="card" style="margin-bottom:12px">
          <div class="card-header"><strong>${escapeHtml(d.title)}</strong></div>
          <div class="card-body">
            <div><strong>Location:</strong> ${escapeHtml(d.location||'—')}</div>
            <div><strong>Dates:</strong> ${escapeHtml(d.start||'—')} to ${escapeHtml(d.end||'—')}</div>
            <div style="margin-top:8px;color:var(--muted)">${escapeHtml(d.description||'No description')}</div>
          </div>
          <div class="card-footer">
            <div style="display:flex;gap:8px">
              <button class="btn btn-primary" onclick='editDrive("${d.id}")'>Edit</button>
              <button class="btn btn-secondary" onclick='deleteDrive("${d.id}")'>Delete</button>
            </div>
            <div style="color:var(--muted)">Created: ${new Date(d.createdAt||Date.now()).toLocaleString()}</div>
          </div>
        </div>`).join('');
    }

    function renderReports(){
      const reports = document.getElementById('reportsContent');
      const donations = readJSON(KEY_DONATIONS);
      const drives = readJSON(KEY_DRIVES);
      const totalDonations = donations.length;
      const pending = donations.filter(d => (d.status||'').toLowerCase() !== 'delivered').length;
      const byStatus = donations.reduce((acc, cur) => { const s=(cur.status||'unknown'); acc[s]= (acc[s]||0)+1; return acc; }, {});
      reports.innerHTML = `
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
          <div class="card"><div class="card-header">Total Donations</div><div class="card-body"><strong>${totalDonations}</strong></div></div>
          <div class="card"><div class="card-header">Pending Deliveries</div><div class="card-body"><strong>${pending}</strong></div></div>
          <div class="card"><div class="card-header">Drives</div><div class="card-body"><strong>${drives.length}</strong></div></div>
        </div>
        <div style="margin-top:12px">
          <h4>Donations by status</h4>
          <pre style="background:#fafafa;border:1px solid #eee;padding:12px;border-radius:8px">${escapeHtml(JSON.stringify(byStatus,null,2))}</pre>
        </div>
      `;
    }

    function renderOverview(){
      const donations = readJSON(KEY_DONATIONS);
      document.getElementById('statUsers').textContent = '—';
      document.getElementById('statDonations').textContent = String(donations.length || 0);
      document.getElementById('statPending').textContent = String(donations.filter(d => (d.status||'').toLowerCase() !== 'delivered').length || 0);
    }

    function editDrive(id){ alert('Edit drive: ' + id); }
    function deleteDrive(id){
      if(!confirm('Delete drive?')) return;
      const arr = readJSON(KEY_DRIVES).filter(d => d.id !== id);
      localStorage.setItem(KEY_DRIVES, JSON.stringify(arr));
      renderDrives();
    }

    var createBtn = document.getElementById('btnCreateDonation');
    if (createBtn) {
      createBtn.addEventListener('click', function(){
        function uuidv4(){ return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c){const r=(Math.random()*16)|0; const v = c=='x'? r : (r&0x3)|0x8; return v.toString(16); }); }
        const d = { id: uuidv4(), title:'Quick Demo Parcel', donor:'Demo User', recipient:'Demo Recipient', status:'pending', history:[{status:'pending',time:new Date().toISOString(),note:'Created from dashboard'}] };
        try {
          const prev = readJSON(KEY_DONATIONS); prev.push(d); localStorage.setItem(KEY_DONATIONS, JSON.stringify(prev));
          alert('Created demo donation with id: ' + d.id + '\nOpening tracker page...');
          window.location.href = 'track.html?id=' + encodeURIComponent(d.id);
        } catch (err) { alert('Failed to create demo donation: ' + (err && err.message)); }
      });
    }

    (function init(){
      const hash = (location.hash || '').replace('#','') || 'overview';
      setTimeout(() => setActiveTab(hash), 0);
      document.getElementById('manageDonations').addEventListener('click', () => { alert('Open donations management (not implemented)'); });
      document.getElementById('viewRoutes').addEventListener('click', () => { setActiveTab('modules'); location.hash = '#modules'; });
    })();
  </script>
</body>
</html>